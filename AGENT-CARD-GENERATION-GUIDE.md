# Agent Card Generation Guide

## Overview

This guide explains how to automatically generate agent cards from your vLEI workflow output. The agent cards contain complete vLEI metadata including real AIDs, credentials, and verification information.

## What Are Agent Cards?

Agent cards are JSON documents that describe AI agents operating within the vLEI ecosystem. They include:

- **Identity**: Agent name, organization, role
- **GLEIF Identity**: LEI, registry, official role
- **vLEI Metadata**: 
  - Delegator AID (OOR holder)
  - Delegatee AID (Agent)
  - Credential SAIDs
  - OOBIs for discovery
  - Verification paths
- **Capabilities**: What the agent can do
- **Skills**: Specific functions the agent performs

## Prerequisites

1. **Completed vLEI Workflow**: You must have run your vLEI workflow successfully
2. **Node.js**: Installed on your system
3. **Generated Data**: The `task-data/` directory should contain output files

## Files Overview

### Input Files (Generated by vLEI Workflow)

```
task-data/
â”œâ”€â”€ jupiterSellerAgent-info.json      # Agent AID and OOBI
â”œâ”€â”€ Jupiter_Chief_Sales_Officer-info.json  # OOR holder AID
â”œâ”€â”€ Jupiter_Knitting_Company-info.json     # LE AID and LEI
â”œâ”€â”€ tommyBuyerAgent-info.json         # Agent AID and OOBI
â”œâ”€â”€ Tommy_Chief_Procurement_Officer-info.json  # OOR holder AID
â”œâ”€â”€ Tommy_Hilfiger_Europe-info.json   # LE AID and LEI
â”œâ”€â”€ oor-credential-info.json          # OOR credential SAID
â””â”€â”€ qvi-info.json                     # QVI AID
```

### Configuration File

```
appconfig/configBuyerSellerAIAgent1.json
```

Contains LEI numbers, organization details, person roles, and agent definitions.

### Generator Scripts

- `generate-agent-cards.js` - Main Node.js script
- `generate-agent-cards.sh` - Shell script wrapper

### Output Files

```
agent-cards/
â”œâ”€â”€ jupiterSellerAgent-card.json
â””â”€â”€ tommyBuyerAgent-card.json
```

## Usage

### Method 1: Using Shell Script (Recommended)

```bash
# Make script executable (first time only)
chmod +x generate-agent-cards.sh

# Run the generator
./generate-agent-cards.sh
```

### Method 2: Direct Node.js Execution

```bash
# Run the Node.js script directly
node generate-agent-cards.js
```

### Method 3: Integrate with Main Workflow

Add to the end of your `run-all.sh` or similar script:

```bash
# At the end of run-all.sh
echo ""
echo "â†’ Generating agent cards..."
./generate-agent-cards.sh
```

## Output Example

After running the generator, you'll see:

```
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  vLEI Agent Card Generator
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

âœ“ Configuration loaded

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Processing: JUPITER KNITTING COMPANY
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

â†’ Generating agent card for: jupiterSellerAgent
âœ“ Agent info loaded: jupiterSellerAgent
âœ“ Person info loaded: Jupiter_Chief_Sales_Officer
âœ“ LE info loaded: Jupiter_Knitting_Company
âœ“ OOR credential info loaded
âœ“ QVI info loaded
âœ“ Agent card generated for jupiterSellerAgent
  Agent AID: EMhQNVE2RFIhaf9j4WfbxGA7xvDRoxcUoTSH0IfsxK6k
  Delegator AID: EJ8sMfueQNpg5gkJZAP476Ee4TgxgvfSFMg1R8JIZD6A
  LEI: 3358004DXAMRWRUIYJ05
âœ“ Agent card saved: ./agent-cards/jupiterSellerAgent-card.json

... [similar output for tommyBuyerAgent] ...

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  âœ… Generation Complete
  Generated 2 agent card(s)
  Output directory: ./agent-cards
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
```

## Generated Agent Card Structure

Each agent card contains:

### 1. Basic Information

```json
{
  "name": "Jupiter Seller Agent",
  "description": "Autonomous AI agent responsible for...",
  "url": "https://jupiter-agent.com/",
  "provider": {
    "organization": "JUPITER KNITTING COMPANY",
    "url": "https://jupiterknitting.com"
  },
  "version": "1.0.0"
}
```

### 2. Capabilities

```json
{
  "capabilities": {
    "streaming": true,
    "stateTransitionHistory": true
  }
}
```

### 3. Skills

```json
{
  "skills": [
    {
      "id": "procurement_management",
      "name": "Procurement Management",
      "description": "Collaborates with verified buyer agents...",
      "tags": ["seller", "procurement", "verification", "gleif"]
    }
  ]
}
```

### 4. Extensions (vLEI Data)

```json
{
  "extensions": {
    "gleifIdentity": {
      "lei": "3358004DXAMRWRUIYJ05",
      "legalEntityName": "JUPITER KNITTING COMPANY",
      "registryName": "JUPITER_REGISTRY",
      "qvi": "ECzkXCdHwFt6S2UZPXjPl6dYz_Iwb5pgf8JiTGHSQT4x",
      "officialRole": "ChiefSalesOfficer",
      "engagementRole": "Seller Agent"
    },
    "vLEImetadata": {
      "delegatorAID": "EJ8sMfueQNpg5gkJZAP476Ee4TgxgvfSFMg1R8JIZD6A",
      "delegateeAID": "EMhQNVE2RFIhaf9j4WfbxGA7xvDRoxcUoTSH0IfsxK6k",
      "delegatorSAID": "EETDbCBDoIy4ZjRqusNyDhG_Mlj4vxIuma5w0waw3ypL",
      "delegateeSAID": "EMhQNVE2RFIhaf9j4WfbxGA7xvDRoxcUoTSH0IfsxK6k",
      "delegatorOOBI": "http://keria:3902/oobi/EJ8sMfueQNpg5gkJZAP476Ee4TgxgvfSFMg1R8JIZD6A/...",
      "delegateeOOBI": "http://keria:3902/oobi/EMhQNVE2RFIhaf9j4WfbxGA7xvDRoxcUoTSH0IfsxK6k/...",
      "leAID": "ENo_qB02qUEGgOg967sl7QnkYeYDaz_AAIZcmX7rlkeQ",
      "leOOBI": "http://keria:3902/oobi/ENo_qB02qUEGgOg967sl7QnkYeYDaz_AAIZcmX7rlkeQ/...",
      "verificationPath": [
        "GLEIF_ROOT â†’ QVI",
        "QVI â†’ JUPITER_KNITTING_COMPANY â†’ Chief_Sales_Officer â†’ jupiterSellerAgent"
      ],
      "status": "verified",
      "verificationEndpoint": "http://vlei-verification:9723/verify/agent-delegation",
      "timestamp": "2025-11-12T14:19:45.123Z"
    },
    "keriIdentifiers": {
      "agentAID": "EMhQNVE2RFIhaf9j4WfbxGA7xvDRoxcUoTSH0IfsxK6k",
      "oorHolderAID": "EJ8sMfueQNpg5gkJZAP476Ee4TgxgvfSFMg1R8JIZD6A",
      "legalEntityAID": "ENo_qB02qUEGgOg967sl7QnkYeYDaz_AAIZcmX7rlkeQ",
      "qviAID": "ECzkXCdHwFt6S2UZPXjPl6dYz_Iwb5pgf8JiTGHSQT4x"
    }
  }
}
```

## Data Mapping

### How Data is Mapped from Output Files

| Agent Card Field | Source File | Field |
|-----------------|-------------|-------|
| `delegateeAID` | `{agent}-info.json` | `aid` |
| `delegateeOOBI` | `{agent}-info.json` | `oobi` |
| `delegatorAID` | `{person}-info.json` | `aid` |
| `delegatorOOBI` | `{person}-info.json` | `oobi` |
| `leAID` | `{org}-info.json` | `aid` |
| `leOOBI` | `{org}-info.json` | `oobi` |
| `lei` | `config.json` | `organizations[].lei` |
| `delegatorSAID` | `oor-credential-info.json` | `said` |
| `qviAID` | `qvi-info.json` | `aid` |

## Customization

### Modifying Agent Skills

Edit the `skills` array in `generate-agent-cards.js`:

```javascript
skills: [
  {
    id: "your_skill_id",
    name: "Your Skill Name",
    description: "Description of what this skill does",
    tags: ["tag1", "tag2"]
  }
]
```

### Adding Custom Extensions

Add new fields to the `extensions` object:

```javascript
extensions: {
  gleifIdentity: { /* ... */ },
  vLEImetadata: { /* ... */ },
  customExtension: {
    yourField: "yourValue"
  }
}
```

### Changing Output Format

Modify the `fs.writeFileSync` call to change formatting:

```javascript
// Pretty print with 2-space indentation
fs.writeFileSync(outputFile, JSON.stringify(agentCard, null, 2));

// Compact format
fs.writeFileSync(outputFile, JSON.stringify(agentCard));

// Custom indentation
fs.writeFileSync(outputFile, JSON.stringify(agentCard, null, 4));
```

## Troubleshooting

### Error: "task-data directory not found"

**Solution**: Run your vLEI workflow first to generate the required data files.

```bash
./run-all-buyerseller-2-with-agents.sh
```

### Error: "Configuration file not found"

**Solution**: Ensure `appconfig/configBuyerSellerAIAgent1.json` exists.

### Error: "Failed to read agent info"

**Causes**:
1. vLEI workflow didn't complete successfully
2. Agent alias in config doesn't match file naming

**Solution**: Check that these files exist:
- `task-data/jupiterSellerAgent-info.json`
- `task-data/tommyBuyerAgent-info.json`

### Missing or Incorrect AIDs

**Solution**: Ensure the vLEI workflow completed all steps:
1. Agent delegation creation
2. OOR holder approval
3. Agent delegation completion
4. Verification via Sally

Check the workflow output for any errors.

## Integration Patterns

### Pattern 1: Automated Generation

Add to `run-all-buyerseller-2-with-agents.sh`:

```bash
#!/bin/bash

# ... existing vLEI workflow ...

# Generate agent cards automatically
echo ""
echo "[6/6] Generating Agent Cards..."
./generate-agent-cards.sh

echo ""
echo "âœ… Complete workflow finished!"
echo "ğŸ“ Agent cards: ./agent-cards/"
```

### Pattern 2: On-Demand Generation

Run manually after workflow:

```bash
# Run workflow
./run-all-buyerseller-2-with-agents.sh

# Generate cards separately
./generate-agent-cards.sh
```

### Pattern 3: CI/CD Integration

```yaml
# .github/workflows/generate-cards.yml
name: Generate Agent Cards
on:
  workflow_run:
    workflows: ["vLEI Workflow"]
    types:
      - completed

jobs:
  generate:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      - name: Setup Node.js
        uses: actions/setup-node@v2
      - name: Generate Cards
        run: ./generate-agent-cards.sh
      - name: Upload Artifacts
        uses: actions/upload-artifact@v2
        with:
          name: agent-cards
          path: agent-cards/
```

## FAQ

### Q: Do I need to set up an A2A server?

**A:** No! The agent card generation is purely file-based. It reads JSON files and writes JSON files. No server setup required.

### Q: Will this modify my existing codebase?

**A:** No. The generator is completely separate from your vLEI workflow. It only reads the output files.

### Q: Can I customize the agent card template?

**A:** Yes! Edit `generate-agent-cards.js` to modify the card structure. The template is flexible and extensible.

### Q: How often should I regenerate agent cards?

**A:** Regenerate whenever:
- You run the vLEI workflow
- Agent credentials are updated
- Configuration changes
- You want fresh timestamps

### Q: Can I add more agents?

**A:** Yes! Add agents to your configuration file:

```json
{
  "persons": [{
    "agents": [
      { "alias": "agent1", "agentType": "AI" },
      { "alias": "agent2", "agentType": "AI" }
    ]
  }]
}
```

The generator will automatically create cards for all configured agents.

### Q: What if I have multiple OOR holders per organization?

**A:** The generator handles this automatically. It processes all persons in each organization and generates cards for all their agents.

### Q: Can I use these cards for A2A communication?

**A:** Yes! These cards contain all necessary vLEI metadata for:
- Agent discovery
- Credential verification
- Trust chain validation
- OOBI resolution

## Best Practices

1. **Always regenerate after workflow changes**: Ensure cards reflect latest AIDs
2. **Version control your cards**: Track changes to agent credentials
3. **Validate before distribution**: Check that all fields are populated correctly
4. **Document custom extensions**: If you add custom fields, document their purpose
5. **Keep templates consistent**: Use the same structure across all agent types
6. **Timestamp everything**: Include generation timestamps for auditability

## Next Steps

1. **Test the Generator**
   ```bash
   ./generate-agent-cards.sh
   ```

2. **Verify Output**
   ```bash
   cat agent-cards/jupiterSellerAgent-card.json | jq .
   ```

3. **Integrate with Workflow**
   - Add to existing scripts
   - Or run manually as needed

4. **Share Agent Cards**
   - Distribute to counterparties
   - Publish for discovery
   - Use in A2A protocols

## Support

For issues or questions:
1. Check this documentation
2. Review the troubleshooting section
3. Examine the generator script
4. Check vLEI workflow logs

## References

- [vLEI Official Documentation](https://www.gleif.org/en/vlei)
- [KERI Specification](https://keri.one/)
- [Agent-to-Agent Protocol](https://github.com/agent-protocol)
- [Your vLEI Implementation Docs](./AGENT-DELEGATION-IMPLEMENTATION-COMPLETE.md)
